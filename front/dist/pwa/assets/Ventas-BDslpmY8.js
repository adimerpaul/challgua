import{_ as A,a5 as h,o as c,a as e,b as a,w as l,Q as _,e as v,d as u,a1 as n,t as r,aq as Q,f as C,Z as x,c as g,a2 as b,a6 as k,a7 as F}from"./index-CYSA57Wy.js";import{Q as m,a as d,b as p}from"./QMenu-DBsCoxvT.js";import{Q as T}from"./QSelect-BzLM9xak.js";import{Q as I,C as w}from"./ClosePopup-KdwEzG9e.js";import{Q as E}from"./QChip-dCgCKOKZ.js";import{Q as q}from"./QMarkupTable-DUTy3n8g.js";import{Q as B}from"./QPage-D5kxqU1T.js";import{h as y}from"./moment-C5S46NFB.js";import{I as S}from"./Imprimir-BTYLFQ2h.js";import{E as Y}from"./Excel-DYSTQ5HC.js";import"./format-BvkBI9bc.js";import"./_commonjsHelpers-Bx2EM-6T.js";const z={name:"Ventas",data(){return{ventas:[],venta:{},ventaDialog:!1,fechaInicio:y().format("YYYY-MM-DD"),fechaFin:y().format("YYYY-MM-DD"),loading:!1,actionPeriodo:"",gestiones:[],users:[],user:"",filter:"",roles:["Doctor","Enfermera","Administrativo","Secretaria"],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"nombre",label:"Nombre",align:"left",field:"nombre"},{name:"descripcion",label:"Descripción",align:"left",field:"descripcion"},{name:"unidad",label:"Unidad",align:"left",field:"unidad"},{name:"precio",label:"Precio",align:"left",field:"precio"},{name:"stock",label:"Stock",align:"left",field:"stock"},{name:"stock_minimo",label:"Stock mínimo",align:"left",field:"stock_minimo"},{name:"stock_maximo",label:"Stock máximo",align:"left",field:"stock_maximo"}]}},mounted(){this.ventasGet(),this.usersGet()},methods:{exportExcel(){let o=[{columns:[{label:"ID",value:"id"},{label:"Fecha",value:"fecha"},{label:"Cliente",value:"cliente.nombre"},{label:"Usuario",value:"user.name"},{label:"Estado",value:"estado"},{label:"Total",value:"total"},{label:"Detalle",value:"detailsText"}],content:this.ventas}];Y.export(o,"Ventas")},usersGet(){this.$axios.get("users").then(o=>{this.users=o.data}).catch(o=>{this.$alert.error(o.response.data.message)})},imprimir(o){S.nota(o)},tipoVentasChange(o){this.$axios.put(`tipoVentasChange/${o}`).then(t=>{this.$alert.success("Tipo de venta cambiado"),this.ventasGet()}).catch(t=>{this.$alert.error(t.response.data.message)})},anular(o){this.$alert.dialog("¿Está seguro de anular la venta?").onOk(()=>{this.$axios.put(`ventasAnular/${o}`).then(t=>{this.$alert.success("Venta anulada"),this.ventasGet()}).catch(t=>{this.$alert.error(t.response.data.message)})})},ventasGet(){this.loading=!0,this.$axios.get("ventas",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,user:this.user}}).then(o=>{this.ventas=o.data}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})}},computed:{usersTodos(){return[{label:"Todos",value:""},...this.users.map(o=>({label:o.name,value:o.id}))]},totalInternos(){return this.ventas.reduce((o,t)=>t.tipo_venta==="Interno"&&t.estado==="Activo"?o+parseFloat(t.total):o,0)},totalExternos(){return this.ventas.reduce((o,t)=>t.tipo_venta==="Externo"&&t.estado==="Activo"?o+parseFloat(t.total):o,0)}}},G={class:"row"},U={class:"col-12 col-md-4 q-pa-xs"},N={class:"col-12 col-md-4 q-pa-xs"},M={class:"col-12 col-md-4 q-pa-xs"},P={class:"col-12"},L={class:"row"},O={class:"col-12 col-md-2"},$={class:"col-12 col-md-2"},R={class:"col-12 col-md-2"},Z={class:"col-12 col-md-2"},j={class:"col-12 col-md-2 text-right"},H={class:"col-12 col-md-2 text-right"},J={class:"text-bold"},K={style:{"max-width":"200px","wrap-option":"wrap","line-height":"0.9"}};function W(o,t,X,ee,i,f){return c(),h(k,null,[e(B,{class:"q-pa-xs"},{default:l(()=>[a("div",G,[a("div",U,[e(_,{flat:"",bordered:""},{default:l(()=>[e(v,{class:"q-pa-none"},{default:l(()=>[e(m,{class:"bg-indigo"},{default:l(()=>[e(d,{avatar:""},{default:l(()=>[e(u,{name:"trending_up",size:"50px",color:"white"})]),_:1}),e(d,null,{default:l(()=>[e(p,{caption:"",class:"text-white"},{default:l(()=>t[4]||(t[4]=[n("Cantidad de Ventas")])),_:1}),e(p,{class:"text-white text-h4"},{default:l(()=>[n(r(i.ventas.filter(s=>s.estado==="Activo").length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",N,[e(_,{flat:"",bordered:""},{default:l(()=>[e(v,{class:"q-pa-none"},{default:l(()=>[e(m,{class:"bg-green"},{default:l(()=>[e(d,{avatar:""},{default:l(()=>[e(u,{name:"monetization_on",size:"50px",color:"white"})]),_:1}),e(d,null,{default:l(()=>[e(p,{caption:"",class:"text-white"},{default:l(()=>t[5]||(t[5]=[n("Ventas Total")])),_:1}),e(p,{class:"text-white text-h4"},{default:l(()=>[n(r(i.ventas.filter(s=>s.estado==="Activo").reduce((s,V)=>s+parseFloat(V.total),0))+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",M,[e(_,{flat:"",bordered:""},{default:l(()=>[e(v,{class:"q-pa-none"},{default:l(()=>[e(m,{class:"bg-red"},{default:l(()=>[e(d,{avatar:""},{default:l(()=>[e(u,{name:"monetization_on",size:"50px",color:"white"})]),_:1}),e(d,null,{default:l(()=>[e(p,{caption:"",class:"text-white"},{default:l(()=>t[6]||(t[6]=[n("Ventas Anuladas")])),_:1}),e(p,{class:"text-white text-h4"},{default:l(()=>[n(r(i.ventas.filter(s=>s.estado==="Anulada").length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",P,[e(_,{flat:"",bordered:""},{default:l(()=>[e(v,{class:"q-pa-none"},{default:l(()=>[a("div",L,[a("div",O,[e(Q,{modelValue:i.fechaInicio,"onUpdate:modelValue":t[0]||(t[0]=s=>i.fechaInicio=s),label:"Fecha inicio",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),a("div",$,[e(Q,{modelValue:i.fechaFin,"onUpdate:modelValue":t[1]||(t[1]=s=>i.fechaFin=s),label:"Fecha fin",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),a("div",R,[e(T,{modelValue:i.user,"onUpdate:modelValue":t[2]||(t[2]=s=>i.user=s),options:f.usersTodos,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),a("div",Z,[e(C,{color:"primary",label:"Buscar","no-caps":"",icon:"search",loading:i.loading,onClick:t[3]||(t[3]=s=>f.ventasGet())},null,8,["loading"])]),a("div",j,[e(I,{color:"primary",label:"Exportar","no-caps":""},{default:l(()=>[x((c(),g(m,{clickable:"",onClick:f.exportExcel},{default:l(()=>[e(d,{avatar:""},{default:l(()=>[e(u,{name:"file_download"})]),_:1}),e(d,null,{default:l(()=>t[7]||(t[7]=[n("Excel")])),_:1})]),_:1},8,["onClick"])),[[b],[w]])]),_:1})]),a("div",H,[e(C,{color:"positive",label:"Nueva venta","no-caps":"",icon:"add_circle_outline",loading:i.loading,to:"/ventaNuevo"},null,8,["loading"])])])]),_:1})]),_:1})])]),e(q,{dense:"","wrap-cells":""},{default:l(()=>[t[10]||(t[10]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",null,"Acciones"),a("th",null,"ID"),a("th",null,"Fecha"),a("th",null,"Cliente"),a("th",null,"Usuario"),a("th",null,"Estado"),a("th",null,"Total"),a("th",null,"Detalle")])],-1)),a("tbody",null,[i.ventas.length!=0?(c(!0),h(k,{key:0},F(i.ventas,(s,V)=>(c(),h("tr",{key:s.id},[a("td",null,[e(I,{color:"primary",label:"Opciones","no-caps":"",dense:"",size:"10px"},{default:l(()=>[x((c(),g(m,{clickable:"",onClick:D=>f.imprimir(s)},{default:l(()=>[e(d,{avatar:""},{default:l(()=>[e(u,{name:"print"})]),_:1}),e(d,null,{default:l(()=>t[8]||(t[8]=[n("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[b],[w]]),x((c(),g(m,{clickable:"",onClick:D=>f.anular(s.id)},{default:l(()=>[e(d,{avatar:""},{default:l(()=>[e(u,{name:"delete"})]),_:1}),e(d,null,{default:l(()=>t[9]||(t[9]=[n("Anular")])),_:1})]),_:2},1032,["onClick"])),[[b],[w]])]),_:2},1024)]),a("td",null,r(s.id),1),a("td",null,r(s.fecha)+" "+r(s.hora),1),a("td",null,r(s.cliente.nombre),1),a("td",null,r(s.user.name),1),a("td",null,[e(E,{color:s.estado==="Activo"?"positive":"negative",class:"text-white",dense:""},{default:l(()=>[n(r(s.estado),1)]),_:2},1032,["color"])]),a("td",J,[n(r(s.total)+" ",1),e(E,{size:"10px",color:s.tipo_pago==="Efectivo"?"green":"blue",class:"text-white",dense:""},{default:l(()=>[n(r(s.tipo_pago.charAt(0)),1)]),_:2},1032,["color"])]),a("td",null,[a("div",K,r(s.detailsText),1)])]))),128)):(c(),h(k,{key:1},[],64))])]),_:1})]),_:1}),t[11]||(t[11]=a("div",{id:"myElement",class:"hidden"},null,-1))],64)}const pe=A(z,[["render",W]]);export{pe as default};
